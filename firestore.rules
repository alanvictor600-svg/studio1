rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    function signedIn() { return request.auth != null; }

    // Config e sorteios: só leitura para logado
    match /configs/{id} {
      allow read: if signedIn();
      allow write: if false;
    }

    match /draws/{id} {
      allow read: if signedIn();
      allow write: if false;
    }

    // Usuário: cada um lê o próprio doc. Admins leem via Admin SDK.
    match /users/{uid} {
      allow read: if signedIn() && request.auth.uid == uid;
      allow write: if false; // Escrita apenas pelo servidor
    }

    // Tickets: usuário só lê os tickets em que participa
    match /tickets/{ticketId} {
      // Um usuário logado pode ler um bilhete se seu UID estiver na lista de 'participants'
      allow read: if signedIn() && (request.auth.uid in resource.data.participants);
      allow create, update, delete: if false; // Ações apenas via servidor
    }

    // Histórico do Vendedor:
    match /sellerHistory/{id} {
      allow read: if signedIn() && request.auth.uid == resource.data.sellerId;
      allow write: if false;
    }

    // Histórico do Admin: Acesso apenas via Admin SDK (nenhuma regra de cliente)
    match /adminHistory/{id} {
        allow read, write, create, delete: if false;
    }
  }
}
